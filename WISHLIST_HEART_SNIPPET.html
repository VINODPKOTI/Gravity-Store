<!-- Add this inside the product image div (after the image tag, before closing </div>) -->
<!-- Place this around line 79 in product_list.html, after the discount badge -->

<!-- Wishlist Heart Icon -->
<form action="{% url 'wishlist:add_to_wishlist' product.pk %}" method="post" class="wishlist-form-{{ product.pk }}"
    style="position: absolute; top: 8px; left: 8px;">
    {% csrf_token %}
    <button type="button" class="wishlist-btn" data-product-id="{{ product.pk }}"
        style="width: 36px; height: 36px; border-radius: 50%; background: rgba(255,255,255,0.9); backdrop-filter: blur(4px); border: none; display: flex; align-items: center; justify-center; box-shadow: 0 2px 8px rgba(0,0,0,0.1); cursor: pointer; transition: all 0.3s;">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="wishlist-heart"
            style="color: #52525b; transition: all 0.3s;">
            <path
                d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" />
        </svg>
    </button>
</form>

<!-- Add this JavaScript before {% endblock %} at the end of product_list.html -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Handle wishlist button clicks
        const wishlistBtns = document.querySelectorAll('.wishlist-btn');

        wishlistBtns.forEach(btn => {
            btn.addEventListener('click', function (e) {
                e.preventDefault();
                e.stopPropagation();

                const productId = this.dataset.productId;
                const heart = this.querySelector('.wishlist-heart');
                const form = this.closest('form');

                // Disable button
                this.disabled = true;
                this.style.opacity = '0.6';

                // Make AJAX request
                fetch(`/wishlist/add/${productId}/`, {
                    method: 'POST',
                    body: new FormData(form),
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            // Turn heart red
                            heart.style.fill = '#ef4444';
                            heart.style.stroke = '#ef4444';
                            heart.style.color = '#ef4444';

                            // Show notification
                            if (typeof showToast === 'function') {
                                showToast(data.message, 'success');
                            }
                        } else {
                            if (typeof showToast === 'function') {
                                showToast(data.message || 'Error', 'error');
                            }
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        if (typeof showToast === 'function') {
                            showToast('Something went wrong', 'error');
                        }
                    })
                    .finally(() => {
                        // Re-enable button
                        this.disabled = false;
                        this.style.opacity = '1';
                    });
            });

            // Hover effect
            btn.addEventListener('mouseenter', function () {
                this.style.transform = 'scale(1.1)';
                this.style.background = 'white';
            });

            btn.addEventListener('mouseleave', function () {
                this.style.transform = 'scale(1)';
            });
        });
    });
</script>

<!-- INSTRUCTIONS:
1. Open templates/products/product_list.html
2. Find the product image section (around line 65-80)
3. Add the wishlist heart form INSIDE the image div, after the discount badge
4. Add the JavaScript at the bottom, before {% endblock %}
5. The heart will appear as a white circle in top-left of each product
6. Clicking it adds to wishlist and turns the heart red
-->